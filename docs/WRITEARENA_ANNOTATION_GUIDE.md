# WriteArena 批注功能使用指南

## 🎉 功能介绍

批注功能已成功集成到 WriteArena 页面！现在您可以对 AI 生成的文章进行详细的质量批注。

## 🚀 快速开始

### 使用流程图

```
1. 进入 WriteArena 页面
    ↓
2. 从下拉框选择并发任务
    ↓
3. 展开文章内容，切换 Markdown/HTML 预览
    ↓
4. 为每个端点评分、打标签、写评语
    ↓
5. （可选）点击✍️进行详细批注
    ↓
6. 标记"采用，计划发布"和"最佳结果"
    ↓
7. 保存评判
```

### 1. 进入 WriteArena 页面

在 Streamlit 侧边栏选择 **WriteArena** 页面。

### 2. 选择并发任务

从下拉框中选择要评判的并发转写任务。

下拉框会显示：
- ✅/⏳ 评判状态（已评判/待评判）
- 任务时间
- 频道名称
- 端点数量

**示例**：`⏳ 2024-10-22 17:47 | AGI启示录 | 4/4 端点`

### 3. 查看文章内容

在任意端点点击 **📄 查看文章内容** 展开预览区。

文章内容以 Markdown 格式显示，简洁清晰。

### 4. 开启内联批注模式

在文章预览区右上角，开启 **✍️ 批注模式** 开关。

开启后，文章会进入批注模式，您可以直接在文章上进行批注。

### 5. 添加批注（内联模式）

1. **选择文本** - 用鼠标拖动选择要批注的文本
2. **填写批注信息**：
   - 选择类型：📝语言问题 / 📊事实错误 / 💡内容建议 / ⚠️风格问题 / 🔧格式问题
   - 选择严重程度：低 / 中 / 高
   - 输入批注内容
3. **保存** - 点击"保存批注"按钮

### 6. 查看批注

- 文章中被批注的文本会高亮显示（黄色背景）
- 点击高亮文本可查看批注详情（弹窗显示）
- 页面下方显示批注列表
- 批注会自动保存到任务数据中

### 7. 关闭批注模式

关闭 **✍️ 批注模式** 开关，回到普通预览模式。

## 📊 界面说明

### 文章预览区布局

```
┌─────────────────────────────────────────┐
│ Magic Claude ⏱ 38.1s                   │
├─────────────────────────────────────────┤
│ ▼ 📄 查看文章内容                       │
│   ┌─────────────────────────────────┐  │
│   │ ✍️ 批注模式 | ✍️ 手动批注        │  │ ← 控制栏
│   ├─────────────────────────────────┤  │
│   │ 文章内容（Markdown 格式）       │  │
│   │ 高亮文本 ← 批注模式              │  │
│   │ ...                              │  │
│   └─────────────────────────────────┘  │
├─────────────────────────────────────────┤
│ 📊 评判区域                             │
└─────────────────────────────────────────┘
```

**控制栏说明**：
- **✍️ 批注模式** - 开关，开启后可直接在文章上批注
- **✍️ 手动批注** - 按钮，如果选择文本不工作时使用

### 内联批注模式布局

```
┌─────────────────────────────────────────┐
│ 文章内容（批注模式）                     │
│                                          │
│ 这是普通文本                             │
│ 这是[高亮文本] ← 已批注                   │
│ 选择文本 → 工具栏弹出                    │
│                                          │
│ ┌─────────────────────────────────────┐  │
│ │ 📋 批注列表                         │  │
│ │ • 📝 语言问题: "高亮文本"           │  │
│ │ • 💡 内容建议: "建议修改"            │  │
│ └─────────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

### 批注工具栏

选择文本后会弹出：

```
┌─────────────────────────┐
│  添加批注                │
├─────────────────────────┤
│  [类型选择 ▼]           │
│  [严重程度 ▼]           │
│  [批注内容输入框]       │
│  [保存] [取消]          │
└─────────────────────────┘
```

## 💡 批注类型说明

| 类型 | 图标 | 使用场景 |
|-----|------|---------|
| **语言问题** | 📝 | 语法错误、表达不清、逻辑混乱 |
| **事实错误** | 📊 | 数据错误、引用不准确 |
| **内容建议** | 💡 | 需要增加深度、补充案例 |
| **风格问题** | ⚠️ | 语气不当、不符合频道风格 |
| **格式问题** | 🔧 | Markdown 格式错误 |

## 🎯 批注最佳实践

### 1. 批注应具体

❌ **不好的批注**：
- 类型：内容建议
- 内容："这里写得不好"

✅ **好的批注**：
- 类型：内容建议
- 严重程度：中
- 内容："这个观点缺乏数据支撑，建议添加近年来的市场统计数据，如'2024年AI市场规模达到XX亿美元，同比增长XX%'"

### 2. 合理使用严重程度

- **高** - 必须修改（如事实错误、严重语法问题）
- **中** - 建议修改（如表达不够清晰、缺少案例）
- **低** - 可选修改（如措辞优化、锦上添花）

### 3. 分类准确

选择正确的批注类型有助于后续分析：
- 如果是"数据不准确" → 选择 📊 事实错误
- 如果是"缺少案例" → 选择 💡 内容建议
- 如果是"语气太强硬" → 选择 ⚠️ 风格问题

## 📁 数据存储

### 批注数据保存位置

批注数据自动保存到：
```
workspace/concurrent_history/{task_id}_{channel}.json
```

### JSON 数据结构

```json
{
  "id": "20241022_174704",
  "channel": "AGI启示录",
  "results": [/* 端点结果 */],
  "judgments": {/* 评判数据 */},
  
  "annotations": {
    "Magic Claude": [
      {
        "id": "anno_001",
        "quote": "AI技术发展迅速",
        "type": "fact",
        "severity": "medium",
        "content": "太笼统，建议加具体数据",
        "created_at": "2024-10-22T18:30:00Z"
      }
    ]
  }
}
```

## 🔍 查看历史批注

### 方法 1：在批注模式下查看

点击批注按钮进入批注模式后，页面下方会显示所有已有批注。

### 方法 2：直接查看 JSON 文件

打开 `workspace/concurrent_history/` 目录下的对应 JSON 文件。

## 📈 批注数据分析

批注数据可用于：

### 1. 模型质量评估

统计每个模型的：
- 批注总数
- 各类型问题的数量
- 高严重度问题的比例

### 2. 提示词优化

基于批注数据识别：
- 常见的内容问题 → 优化提示词中的要求
- 频繁的风格问题 → 调整语气和立场
- 事实错误 → 加强准确性要求

### 3. A/B 测试

对比不同端点：
- 哪个端点问题最少
- 哪个端点更符合要求
- 不同类型文章的最佳模型

## ⚠️ 注意事项

### 1. 批注保存

- ✅ 批注会**自动保存**到 JSON 文件
- ✅ 无需手动点击保存按钮
- ℹ️ 每次添加或删除批注后会立即保存

### 2. 批注高亮

- ⚠️ 当前版本不支持持久化高亮
- 📝 高亮只在当前批注会话中显示
- 💡 批注数据会永久保存，但重新打开时不会自动高亮

### 3. 文本选择限制

- ⚠️ 建议在单个段落内选择文本
- ⚠️ 跨段落选择可能无法高亮
- 💡 如需批注多个段落，请分别添加批注

### 4. 浏览器兼容性

- ✅ Chrome/Edge - 完全支持
- ✅ Firefox - 完全支持
- ✅ Safari - 完全支持

## 🐛 故障排查

### 问题1：点击批注按钮无反应

**解决方法**：
1. 检查是否选择了任务
2. 刷新页面重试
3. 查看浏览器控制台是否有错误

### 问题2：无法添加批注

**解决方法**：
1. 确保选择了文本（文本应高亮）
2. 检查是否填写了批注内容
3. 尝试在单个段落内选择文本

### 问题3：批注不保存

**解决方法**：
1. 检查 `workspace/concurrent_history/` 目录权限
2. 确保 JSON 文件可写
3. 查看是否有报错信息

### 问题4：批注工具栏位置不对

**解决方法**：
- 这是正常的，工具栏会出现在选中文本的下方
- 如果看不到，尝试向下滚动页面

## 📚 相关文档

- [批注系统技术文档](./ARTICLE_ANNOTATION_SYSTEM.md) - 完整的技术说明
- [WriteArena 页面](../pages/13_WriteArena.py) - 页面源码
- [批注 JS 库](../static/js/article_annotator.js) - JavaScript 实现

## 💬 使用技巧

### 技巧1：快捷批注

对于常见问题，可以建立批注模板：
- "数据不足" → 事实错误 + 中 + "建议添加具体数据支撑"
- "案例缺失" → 内容建议 + 中 + "建议增加实际案例说明"

### 技巧2：批量处理

一次批注会话中：
1. 先完整阅读文章
2. 识别所有问题点
3. 逐一添加批注
4. 最后查看批注列表，确认完整

### 技巧3：优先级管理

建议按严重程度顺序批注：
1. 先标注高优先级问题（必须修改）
2. 再标注中优先级问题（建议修改）
3. 最后标注低优先级问题（可选修改）

## 🎓 学习资源

### 示例批注场景

#### 场景1：技术文章

**文章片段**："AI技术发展很快，未来会有很大前景。"

**批注示例**：
- **类型**：事实错误
- **严重程度**：高
- **内容**："表述过于笼统，缺乏具体数据。建议改为：'2024年全球AI市场规模达到XXX亿美元，预计2025年将增长XX%，主要增长领域包括...'"

#### 场景2：观点文章

**文章片段**："这种观点完全错误，不值一提。"

**批注示例**：
- **类型**：风格问题
- **严重程度**：高
- **内容**："语气过于绝对和对抗，不符合频道的客观理性风格。建议改为：'这种观点存在一定局限性，主要体现在...'"

#### 场景3：教程文章

**文章片段**："然后点击确定按钮。"

**批注示例**：
- **类型**：内容建议
- **严重程度**：中
- **内容**："缺少截图说明，建议添加操作界面截图，标注'确定'按钮位置，提升教程实用性。"

## ✨ 总结

批注功能让您能够：
- ✅ 系统化地评估 AI 生成内容质量
- ✅ 积累模型问题数据库
- ✅ 指导提示词优化方向
- ✅ 提升内容质量标准

开始使用批注功能，让 AI 内容质量持续提升！🚀

---

**文档版本**: v1.0.0  
**最后更新**: 2024年10月22日  
**维护状态**: 🟢 活跃维护

