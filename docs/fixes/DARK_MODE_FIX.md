# 暗黑模式配色修复

## 问题描述

用户反馈在暗黑模式下，界面配色混乱，视觉效果不佳。经检查发现，主题CSS文件（`anthropic_theme.css`）只定义了亮色模式的样式，没有针对暗黑模式进行适配。

## 解决方案

在 `static/css/anthropic_theme.css` 文件中添加了完整的暗黑模式支持，包括：

### 1. 全局样式适配

```css
/* 暗黑模式全局背景 */
.stApp {
    background-color: #0E1117;  /* 深灰蓝色 */
}

/* 暗黑模式侧边栏 */
[data-testid="stSidebar"] {
    background-color: #161B22;  /* 深灰色 */
}
```

### 2. 文本颜色适配

- **主标题/页面标题/章节标题**: `#E8E6E3` (浅灰白色)
- **副标题**: `#9CA3AF` (中灰色)
- **卡片标题**: `#E8E6E3` (浅灰白色)
- **卡片描述**: `#B0B3B8` (柔和灰色)

### 3. 卡片样式适配

- **基础卡片背景**: `#1C1F26` (深色背景)
- **卡片边框**: `#2D3139` (深灰边框)
- **悬停阴影**: 更深的暗色阴影
- **图标颜色**: `#E8E6E3` (浅色)

### 4. 卡片渐变色适配

将8种大地色系渐变调整为深色版本，保持视觉层次：

1. **card-gradient-1**: `#3A2822 → #2D1F1A` (深赤陶色)
2. **card-gradient-2**: `#2D2821 → #25221C` (深温暖米)
3. **card-gradient-3**: `#2A2622 → #231F1C` (深浅棕)
4. **card-gradient-4**: `#26241F → #1F1D19` (深橄榄棕)
5. **card-gradient-5**: `#2E2621 → #272118` (深暖沙)
6. **card-gradient-6**: `#2F2A24 → #282420` (深奶油)
7. **card-gradient-7**: `#29251F → #221E1A` (深灰褐)
8. **card-gradient-8**: `#2C2620 → #24201B` (深肉桂)

### 5. 面板样式适配

- **信息面板/内容面板**: 深色背景 `#1C1F26`
- **面板标题**: 浅色文本 `#E8E6E3`
- **面板内容**: 中等灰色 `#B0B3B8`

### 6. 统计信息适配

- **统计盒子背景**: 深赤陶色渐变
- **统计数字/标签**: 浅色文本 `#E8E6E3`

### 7. 表单元素适配

- **输入框背景**: `#1C1F26`
- **输入框边框**: `#2D3139`
- **输入框文本**: `#E8E6E3`

### 8. 分隔线适配

- **分隔线颜色**: `#2D3139` (深灰色)

## 技术实现

### 兼容性处理

使用了多重选择器和媒体查询确保兼容不同版本的Streamlit：

```css
/* 方式1: 多重选择器覆盖 */
:is(html[data-theme="dark"], 
    body[data-theme="dark"], 
    .stApp[data-theme="dark"], 
    [data-testid="stAppViewContainer"][data-theme="dark"], 
    :root[data-theme="dark"]) .element {
    /* 暗黑模式样式 */
}

/* 方式2: 系统偏好兜底 */
@media (prefers-color-scheme: dark) {
    .element {
        /* 暗黑模式样式 */
    }
}
```

### 优先级保证

所有暗黑模式样式都使用了 `!important` 标记，确保能够覆盖默认样式。

## 配色方案

### 亮色模式

- 背景色: `#F5F1E8` (米黄色)
- 侧边栏: `#FAFAF8` (浅米色)
- 主标题: `#2B2B2B` (深灰黑)
- 副标题: `#6B6B6B` (中灰)
- 正文: `#5A5A5A` (柔和灰)
- 强调色: `#D97A5E` (赤陶橙)

### 暗黑模式

- 背景色: `#0E1117` (深灰蓝)
- 侧边栏: `#161B22` (深灰)
- 主标题: `#E8E6E3` (浅灰白)
- 副标题: `#9CA3AF` (中灰)
- 正文: `#B0B3B8` (柔和灰)
- 强调色: `#D97A5E` (赤陶橙)

## 测试建议

1. 在Streamlit应用的设置中切换到暗黑模式
2. 检查所有页面的显示效果：
   - 首页卡片
   - 各功能页面
   - 表单元素
   - 信息面板
   - 统计信息
3. 验证文本可读性
4. 检查色彩对比度是否符合无障碍标准

## 影响范围

- ✅ 所有使用 `load_anthropic_theme()` 的页面
- ✅ 所有使用 `apply_page_config()` 的页面
- ✅ 首页 (`homepage.py`)
- ✅ 所有功能页面 (`pages/`)

## 后续优化建议

1. 可以考虑添加更多细节的暗黑模式适配（如警告面板、成功面板等）
2. 可以根据用户反馈进一步调整暗黑模式的配色
3. 考虑添加主题切换的快捷按钮

## 修复日期

2025-10-21

## 相关文件

- `static/css/anthropic_theme.css` - 主题CSS文件（已修改）
- `core/utils/theme_loader.py` - 主题加载器（无需修改）
- `homepage.py` - 首页（使用主题）
- `pages/*.py` - 各功能页面（使用主题）

