# Token管理器功能说明

## 概述

Token管理器是一个专门用于管理微信公众号Token的工具，它能够自动读取、保存和更新每个公众号的Token信息，确保数据获取过程的顺利进行。

## 主要功能

### 1. 自动Token管理
- **自动读取**: 根据选择的公众号自动读取对应的Token
- **自动保存**: 用户修改Token后自动保存到配置文件
- **自动更新**: 数据获取成功后自动更新Token的更新时间

### 2. 配置文件管理
- **JSON格式**: 使用JSON格式存储Token配置，便于管理和备份
- **版本控制**: 支持配置文件版本管理和元数据记录
- **自动备份**: 提供配置文件备份功能

### 3. 账号管理
- **预设账号**: 包含常用的公众号账号（AGI观察室、AGI启示录、AI万象志、人工智能漫游指南）
- **自定义账号**: 支持添加新的公众号账号
- **状态监控**: 实时监控每个账号的Token配置状态

## 使用方法

### 1. 在数据获取页面
1. 选择要获取数据的公众号
2. Token输入框会自动显示该公众号的Token
3. 如需修改Token，输入新值后点击"更新Token"按钮
4. 系统会自动保存并更新配置

### 2. 在Cookie和Token管理页面
1. **添加新账号**: 在"添加新账号"展开框中输入账号名称、描述和Token
2. **备份配置**: 点击"备份Token配置"按钮进行配置备份
3. **状态监控**: 查看所有账号的Token配置状态

## 配置文件结构

```json
{
  "tokens": {
    "AGI观察室": {
      "token": "254511315",
      "last_updated": "2025-01-15T10:00:00",
      "status": "active",
      "description": "AGI观察室公众号的token"
    }
  },
  "metadata": {
    "version": "1.0",
    "created_at": "2025-01-15T10:00:00",
    "last_modified": "2025-01-15T10:00:00",
    "description": "微信公众号Token配置文件"
  }
}
```

## 核心类和方法

### TokenManager类

#### 主要方法
- `get_token(account_name)`: 获取指定公众号的Token
- `set_token(account_name, token, description)`: 设置指定公众号的Token
- `get_token_status(account_name)`: 获取Token状态信息
- `add_custom_account(account_name, description)`: 添加自定义账号
- `backup_config(backup_dir)`: 备份配置文件

#### 状态管理
- **active**: Token已配置且可用
- **inactive**: Token未配置
- **not_found**: 公众号未在配置中找到

## 集成方式

### 1. 与Cookie管理器协同工作
- Token管理器和Cookie管理器并行工作
- 在添加新账号时同时创建Cookie和Token配置
- 在数据获取成功后同时更新Cookie和Token时间

### 2. 与数据获取流程集成
- 在微信公众号数据获取页面自动读取Token
- 支持Token的实时更新和保存
- 数据获取成功后自动刷新Token状态

## 优势特点

1. **自动化**: 减少手动输入Token的步骤
2. **持久化**: Token配置持久保存，重启应用后仍然有效
3. **统一管理**: 集中管理所有公众号的Token信息
4. **状态监控**: 实时了解每个账号的Token配置状态
5. **备份恢复**: 支持配置文件的备份和恢复

## 注意事项

1. **Token安全**: Token是敏感信息，请妥善保管配置文件
2. **定期更新**: 建议定期检查和更新Token配置
3. **备份重要**: 重要配置变更前建议先备份
4. **权限管理**: 确保应用有读写配置文件的权限

## 故障排除

### 常见问题
1. **Token读取失败**: 检查配置文件是否存在且格式正确
2. **保存失败**: 检查应用是否有写入权限
3. **状态显示异常**: 检查配置文件中的时间格式

### 解决方案
1. 重新启动应用
2. 检查配置文件权限
3. 手动编辑配置文件修复格式问题
4. 使用备份文件恢复配置
